<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <style>

    .state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 0.5px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
    }

    </style>
    <svg width="1200" height="800" style="border:1px gainsboro solid"></svg>
    <script src="d3.v4.min.js"></script>
    <script src="topojson.v2.min.js"></script>
    <script src="jquery-1.12.1.min.js"></script>

    <script>
    var svg = d3.select("svg"),
        width = svg.attr("width"),
        height = svg.attr("height");

    var projection = d3.geoMercator()
        .center([107, 31])
        .scale(950)
        .translate([width / 2, height / 2 + height / 6]);

    var path = d3.geoPath()
        .projection(projection);

    d3.json("china.json", function(error, us) {
        if (error) throw error;

        var dataset = {
            "states": [
{"name": "上海","value": 207},
{"name": "北京","value": 46},
{"name": "四川","value": 2},
{"name": "天津","value": 2},
{"name": "安徽","value": 1},
{"name": "山东","value": 7},
{"name": "广东","value": 20},
{"name": "广西","value": 2},
{"name": "江苏","value": 6},
{"name": "河北","value": 1},
{"name": "河南","value": 1},
{"name": "浙江","value": 13},
{"name": "海南","value": 3},
{"name": "湖北","value": 2},
{"name": "湖南","value": 2},
{"name": "福建","value": 5},
{"name": "重庆","value": 1},
{"name": "陕西","value": 2}
            ]
        };
        var datas = [];
        var datam = [];
        for (var i = 0; i < dataset.states.length; i++) {
            var name = dataset.states[i].name;
            var value = dataset.states[i].value;
            datas[name] = value;
            datam.push(value);
        }

        var maxdata = d3.max(dataset.states, function(d) {
            return d.value;
        });
        var mindata = 0;

        var sqrt = d3.scaleSqrt()
            .domain([mindata, maxdata])
            .range([0, 1]);

        var b = d3.rgb(143, 101, 138);
        var a = d3.rgb(237, 216, 235);

        var color = d3.interpolate(a, b);

        svg.append("g")
            .selectAll("path")
            .data(us.features)
            .enter()
            .append("path")
            .attr("stroke", "white")
            .attr("fill", "#f5f5f5")
            .attr("d", path)
            .append("title")
            .text(function(d) {
                a = d
                return d.properties.name
            });

        svg.append("path")
            .attr("class", "state-borders")
            .attr("d", path(topojson.mesh(us, us, function(a, b) {
                return a !== b;
            })));

        svg.selectAll("circle")
            .data(us.features)
            .enter()
            .append("circle")
            .attr("r", function(d, i) {
                var r = 0;
                if (datas[d.properties.name] != undefined) {
                    r = sqrt(datas[d.properties.name]);
                }
                r = 50 * r;
                return r;
            })
            .attr("transform", function(d, i) {
                var r = 0;
                if (datas[d.properties.name] != undefined) {
                    r = sqrt(datas[d.properties.name]);
                }
                r = 50 * r;

                if (d.properties.adcode == "130000") { //河北
                    return "translate(" + (path.centroid(d)[0] - 30 + 10) + "," + (path.centroid(d)[1] + 30 - 5) + ")";
                } else if (d.properties.adcode == "150000") { //内蒙古
                    return "translate(" + (path.centroid(d)[0] - 10 + 10) + "," + (path.centroid(d)[1] + 20 - 5) + ")";
                } else if (d.properties.adcode == "460000") { //海南
                    return "translate(" + (path.centroid(d)[0] - 15 + 10) + "," + (path.centroid(d)[1] - 15 - 5) + ")";
                } else if (d.properties.adcode == "500000") { //重庆
                    return "translate(" + (path.centroid(d)[0] - 15 + 10) + "," + (path.centroid(d)[1] + 10 - 5) + ")";
                } else if (d.properties.adcode == "610000" || d.properties.adcode == "320000") { //陕西 & 江苏
                    return "translate(" + (path.centroid(d)[0] - 5 + 10) + "," + (path.centroid(d)[1] + 5 - 5) + ")";
                } else if (d.properties.adcode == "620000") { //甘肃
                    return "translate(" + (path.centroid(d)[0] + 10 + 10) + "," + (path.centroid(d)[1] - 5) + ")";
                } else if (d.properties.adcode == "640000") { //宁夏
                    return "translate(" + (path.centroid(d)[0] - 10 + 10) + "," + (path.centroid(d)[1] - 5) + ")";
                } else if (d.properties.adcode == "710000") { //台湾
                    return "translate(" + (path.centroid(d)[0] - 10 + 10) + "," + (path.centroid(d)[1] - 5) + ")";
                } else if (d.properties.adcode == "810000") { //香港
                    return "translate(" + (path.centroid(d)[0] + 10) + "," + (path.centroid(d)[1] + 5 - 5) + ")";
                } else if (d.properties.adcode == "820000") { //澳门
                    return "translate(" + (path.centroid(d)[0] - 20 + 10) + "," + (path.centroid(d)[1] + 5 - 5) + ")";
                }
                return "translate(" + (path.centroid(d)[0] - 10 + 10) + "," + (path.centroid(d)[1] + 5 - 5) + ")";
            })
            .attr("fill", function(d, i) {
                var t = 0;
                if (datas[d.properties.name] != undefined) {
                    t = sqrt(datas[d.properties.name]);
                }
                var col = color(t);
                return col.toString();
            })
            .attr("opacity", "0.8");

        /**
        svg.selectAll("text")
            .data(us.features)
            .enter()
            .append("text")
            .attr("transform", function(d, i) {
                if (d.properties.adcode == "130000") { //河北
                    return "translate(" + (path.centroid(d)[0] - 30) + "," + (path.centroid(d)[1] + 30) + ")";
                } else if (d.properties.adcode == "150000") { //内蒙古
                    return "translate(" + (path.centroid(d)[0] - 10) + "," + (path.centroid(d)[1] + 20) + ")";
                } else if (d.properties.adcode == "460000") { //海南
                    return "translate(" + (path.centroid(d)[0] - 15) + "," + (path.centroid(d)[1] - 15) + ")";
                } else if (d.properties.adcode == "500000") { //重庆
                    return "translate(" + (path.centroid(d)[0] - 15) + "," + (path.centroid(d)[1] + 10) + ")";
                } else if (d.properties.adcode == "610000" || d.properties.adcode == "320000") { //陕西 & 江苏
                    return "translate(" + (path.centroid(d)[0] - 5) + "," + (path.centroid(d)[1] + 5) + ")";
                } else if (d.properties.adcode == "620000") { //甘肃
                    return "translate(" + (path.centroid(d)[0] + 10) + "," + (path.centroid(d)[1]) + ")";
                } else if (d.properties.adcode == "640000") { //宁夏
                    return "translate(" + (path.centroid(d)[0] - 10) + "," + (path.centroid(d)[1]) + ")";
                } else if (d.properties.adcode == "710000") { //台湾
                    return "translate(" + (path.centroid(d)[0] - 10) + "," + (path.centroid(d)[1]) + ")";
                } else if (d.properties.adcode == "810000") { //香港
                    return "translate(" + (path.centroid(d)[0]) + "," + (path.centroid(d)[1] + 5) + ")";
                } else if (d.properties.adcode == "820000") { //澳门
                    return "translate(" + (path.centroid(d)[0] - 20) + "," + (path.centroid(d)[1] + 5) + ")";
                }
                return "translate(" + (path.centroid(d)[0] - 10) + "," + (path.centroid(d)[1] + 5) + ")";
            })
            .text(function(d) {
                return d.properties.name;
            })
            .attr("font-size", 10);
        **/
    });
    </script>
</head>
<body>

</body>
</html>